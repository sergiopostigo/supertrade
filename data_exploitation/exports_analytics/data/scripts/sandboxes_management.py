"""
Exploitation Zone
Sandboxes Management

Create or update the sandboxes in the Exploitation Zone

"""

from database_settings import postgres_utilities

def main():

    print('Creating/Updating Sandboxes in Exploitation Zone')

    # Establish the connection with the Persistent Zone
    engine = postgres_utilities.engine()

    # View: peru_exports_sandbox
    peru_exports_sandbox(engine)

    print('Sandboxes successfully created/updated in Exploitation Zone')

def peru_exports_sandbox(engine):
    """
    Peru Exports Sandbox

    This view contains the data from peru_exports but filtered with some conditions gotten from the exploratory
    data analysis. Additionally, some headings and their descriptions are mapped according to peru_exports_headings

    """

    # Filters
    net_weight_threshold = 100
    value_usd_threshold = 200
    headings_count_threshold = 1000
    year_threshold = 2017

    # Create view
    postgres_utilities.run_query_file(engine,'../queries/create_view_peru_exports_sandbox.sql',
                                               params={'year_threshold': year_threshold,
                                                       'headings_count_threshold': headings_count_threshold,
                                                       'value_usd_threshold': value_usd_threshold,
                                                       'net_weight_threshold': net_weight_threshold})


if __name__ == '__main__':
    main()